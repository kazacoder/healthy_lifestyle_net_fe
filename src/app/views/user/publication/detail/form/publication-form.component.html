<div class="publication-form" [formGroup]="publicationForm">
  <div class="publication-form__grid">
    <div class="fg" [ngClass]="{'_error': getControlValidity('title')}">
      <label>Название</label>
      <input type="text" [formControlName]="'title'" placeholder="Например: Ретрит">
      <div class="fg__error-text">
        <div class="text12">Обязательное поле</div>
      </div>
    </div>
    <div class="fg" [ngClass]="{'_error': getControlValidity('phone')}">
      <label>Номер телефона</label>
      <input type="tel"
             mask="(000) 000-00-00"
             [prefix]="'+7 '"
             [instantPrefix]="true"
             placeholder="+7 (___) ___-__-__"
             (input)="cleanError('phone')" [formControlName]="'phone'">
      <div class="fg__error-text">
        <div class="text12" *ngIf="getControlValidity('phone')?.required">Обязательное поле</div>
        <div class="text12" *ngIf="getControlValidity('phone')?.mask">
          Формат ввода: {{ getControlValidity('phone')?.mask['requiredMask']}}
        </div>
        <div class="text12" *ngIf="errors && errors?.phone">{{ errors.phone![0] }}</div>
      </div>
    </div>
    <div class="fg"
         [ngClass]="{'_error': getControlValidity('ticketAmount',  null, 'ticket_amount')}">
      <label>Кол-во билетов</label>
      <input type="text"
             mask="0*"
             (input)="cleanError('ticket_amount')" [formControlName]="'ticketAmount'">
      <div class="fg__error-text">
        <div class="text12" *ngIf="getControlValidity('ticketAmount')?.required">Обязательное поле</div>
        <div class="text12" *ngIf="errors && errors?.ticket_amount">{{ errors.ticket_amount![0] }}</div>
      </div>
    </div>
    <div class="pricing" *ngIf="!isMaster">
      <div class="pricing__title">Стоимость</div>
      <div class="pricing__grid">
        <div [ngClass]="{_active: publicationForm.get('pricing').value === '_free'}"
             class="pricing__free pricing__item">
          <div class="m-check">
            <input checked type="radio" name="pricing" value="_free" formControlName="pricing">
            <label>
              <span>Бесплатно</span>
            </label>
          </div>
        </div>
        <div [ngClass]="{_active: publicationForm.get('pricing').value === '_from'}"
             class="pricing__count pricing__item">
          <div class="text16">от</div>
          <div class="m-check">
            <input type="radio" name="pricing" value="_from" formControlName="pricing">
            <label></label>
          </div>
          <input
            (click)="setPricing('_from')"
            formControlName="price"
            type="number" value="1800" class="pricing__value">
          <div class="pricing__currency">
            <span>₽</span>
          </div>
        </div>
      </div>
    </div>
    <div class="pricing__wrap" *ngIf="isMaster">
      <div class="pricing">
        <div class="pricing__title">Стоимость</div>
        <div class="pricing__grid pg"  [ngClass]="{'_error': getControlValidity('price')}">
          <div [ngClass]="{_active: publicationForm.get('pricing').value === '_free'}"
               class="pricing__free pricing__item">
            <div class="m-check">
              <input checked type="radio" name="pricing" value="_free" formControlName="pricing">
              <label>
                <span>Бесплатно</span>
              </label>
            </div>
          </div>
          <div [ngClass]="{_active: publicationForm.get('pricing').value === '_from'}"
               class="pricing__count pricing__item">
            <div class="text16">от</div>
            <div class="m-check">
              <input type="radio" name="pricing" value="_from" formControlName="pricing">
              <label></label>
            </div>
            <input type="number"
                   (click)="setPricing('_from')"
                   (input)="cleanError('price')"
                   formControlName="price"
                   value="1800" class="pricing__value">
            <div class="pricing__currency">
              <span>₽</span>
            </div>
          </div>
          <div></div>
          <div class="pg__error-text">
            <div class="text12" *ngIf="getControlValidity('price')?.required">Обязательное поле</div>
            <div class="text12" *ngIf="errors && errors?.price">{{ errors.price![0] }}</div>
          </div>
        </div>
      </div>
      <div class="prepayment pg"  [ngClass]="{'_error': getControlValidity('prepayment')}">
        <div class="prepayment__top">
          <div class="pricing__title">
            Размер предоплаты
          </div>
          <div class="hint">
            <button class="hint__btn">
              <img src="assets/img/info-icon2.svg" alt="">
            </button>
            <div class="hint__tooltip">
              <div class="hint__inner _triangle">
                <div class="hint__text">
                  Размер предоплаты составляет не менее 20% от стоимости.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div [ngClass]="{_active: publicationForm.get('pricing').value === '_from'}"
             class="pricing__count pricing__item">
          <input type="number"
                 (click)="setPricing('_from')"
                 (input)="cleanError('prepayment')"
                 formControlName="prepayment"
                 value="5000" class="pricing__value">
          <div class="pricing__currency">
            <span>₽</span>
          </div>
        </div>
        <div class="pg__error-text">
          <div class="text12" *ngIf="getControlValidity('prepayment')?.required">Обязательное поле</div>
          <div class="text12" *ngIf="errors && errors?.prepayment">{{ errors.prepayment![0] }}</div>
        </div>
      </div>
    </div>
    <div class="publication-form__group publication-form__group--col2">
      <div formGroupName="duration" class="">
        <div class="fg col_span">
          <label>Длительность мероприятия</label>
        </div>
        <div class="publication-form__group publication-form__group--col2">
          <div class="fg mb-1_5" [ngClass]="{'_error': getControlValidity('amount', 'duration', 'duration')}">
            <input type="text"
                   mask="0*"
                   [formControlName]="'amount'"
                   (input)="cleanError('duration')"
                   placeholder="кол-во">
            <div class="fg__error-text">
              <div class="text12" *ngIf="getControlValidity('amount', 'duration', 'duration')?.required">Обязательное поле</div>
              <div class="text12" *ngIf="errors && errors?.duration">{{ errors.duration![0] }}</div>
            </div>
          </div>
          <div class="fg">
            <ng-select
              [items]="timePeriod"
              bindLabel="title"
              bindValue="id"
              [clearable]="false"
              [searchable]="false"
              [formControlName]="'timePeriod'"
              placeholder="Период">
            </ng-select>
          </div>
        </div>
      </div>
      <div class="">
        <div class="fg" [ngClass]="{'_error': getControlValidity('format')}">
          <label>Формат</label>
        </div>
        <div class="fg">
          <ng-select
            [items]="format"
            bindLabel="title"
            bindValue="id"
            [clearable]="false"
            [searchable]="true"
            [formControlName]="'format'"
            (change)="checkFormat()"
            placeholder="Выберите формат">
          </ng-select>
          <div class="fg__error-text">
            <div class="text12">Обязательное поле</div>
          </div>
        </div>
      </div>
    </div>
    <ng-container formGroupName="address" *ngIf="offline">
      <div class="fg" [ngClass]="{'_error': getControlValidity('city', 'address')}">
        <label>Город</label>
        <input type="text"
               (input)="cleanError('city')"
               [formControlName]="'city'"
               aria-label="City"
               matInput
               [matAutocomplete]="cityAuto"
               (blur)="validateOrAutocompleteAddressItemSelection('address.city', cities)"
               (change)="cleanControls(['address.street', 'address.house'])"
               placeholder="Например: Москва">
        <mat-autocomplete #cityAuto="matAutocomplete" [displayWith]="displayValue">
          <mat-option *ngFor="let option of cities$ | async" [value]="option">
            {{ option.value }}
          </mat-option>
        </mat-autocomplete>
        <div class="fg__error-text">
          <div class="text12" *ngIf="getControlValidity('city', 'address')?.required">Обязательное поле</div>
          <div class="text12" *ngIf="getControlValidity('city', 'address')?.invalidChoice">Начните вводить и выберите город из списка</div>
          <div class="text12" *ngIf="errors && errors?.city">{{ errors.city![0] }}</div>
        </div>
        <button type="button" class="add-btn m-btn-bounce">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M4.0013 15.1668H12.0013C12.8408 15.1658 13.6457 14.8318 14.2393 14.2382C14.8329 13.6445 15.1669 12.8397 15.168 12.0002V4.00016C15.1669 3.16064 14.8329 2.3558 14.2393 1.76216C13.6457 1.16852 12.8408 0.834555 12.0013 0.833496H4.0013C3.16177 0.834555 2.35693 1.16852 1.7633 1.76216C1.16966 2.3558 0.835693 3.16064 0.834635 4.00016V12.0002C0.835693 12.8397 1.16966 13.6445 1.7633 14.2382C2.35693 14.8318 3.16177 15.1658 4.0013 15.1668ZM12.0013 1.8335C12.5757 1.8342 13.1264 2.0627 13.5326 2.46888C13.9388 2.87505 14.1673 3.42574 14.168 4.00016V12.0002C14.1673 12.5746 13.9388 13.1253 13.5326 13.5314C13.1264 13.9376 12.5757 14.1661 12.0013 14.1668H4.0013C3.42688 14.1661 2.87619 13.9376 2.47002 13.5314C2.06384 13.1253 1.83534 12.5746 1.83464 12.0002V4.00016C1.83534 3.42574 2.06384 2.87505 2.47002 2.46888C2.87619 2.0627 3.42688 1.8342 4.0013 1.8335H12.0013Z"
              fill="#BDDA13"></path>
            <path
              d="M8 11.8337C8.13261 11.8337 8.25978 11.781 8.35355 11.6872C8.44732 11.5934 8.5 11.4663 8.5 11.3337V4.66699C8.5 4.53438 8.44732 4.40721 8.35355 4.31344C8.25978 4.21967 8.13261 4.16699 8 4.16699C7.86739 4.16699 7.74022 4.21967 7.64645 4.31344C7.55268 4.40721 7.5 4.53438 7.5 4.66699V11.3337C7.5 11.4663 7.55268 11.5934 7.64645 11.6872C7.74022 11.781 7.86739 11.8337 8 11.8337Z"
              fill="#BDDA13"></path>
            <path
              d="M4.66927 8.5H11.3359C11.4685 8.5 11.5957 8.44732 11.6895 8.35355C11.7833 8.25978 11.8359 8.13261 11.8359 8C11.8359 7.86739 11.7833 7.74022 11.6895 7.64645C11.5957 7.55268 11.4685 7.5 11.3359 7.5H4.66927C4.53666 7.5 4.40949 7.55268 4.31572 7.64645C4.22195 7.74022 4.16927 7.86739 4.16927 8C4.16927 8.13261 4.22195 8.25978 4.31572 8.35355C4.40949 8.44732 4.53666 8.5 4.66927 8.5Z"
              fill="#BDDA13"></path>
          </svg>
          <span>Указать на карте</span>
        </button>
      </div>
      <div class="fg" [ngClass]="{'_error': getControlValidity('street', 'address')}">
        <label>Улица</label>
        <input type="text"
               (input)="cleanError('street')"
               [formControlName]="'street'"
               aria-label="Street"
               matInput
               [matAutocomplete]="streetAuto"
               (change)="cleanControls(['address.house'])"
               (blur)="validateOrAutocompleteAddressItemSelection('address.street', streets)"
               placeholder="Например: Волочаевская">
        <mat-autocomplete #streetAuto="matAutocomplete" [displayWith]="displayValue">
          <mat-option *ngFor="let option of streets$ | async" [value]="option">
            {{ option.value }}
          </mat-option>
        </mat-autocomplete>
        <div class="fg__error-text">
          <div class="text12" *ngIf="getControlValidity('street', 'address')?.required">Обязательное поле</div>
          <div class="text12" *ngIf="getControlValidity('street', 'address')?.invalidChoice">Начните вводить и выберите город из списка</div>
          <div class="text12" *ngIf="errors && errors?.street">{{ errors.street![0] }}</div>
        </div>
      </div>
      <div class="publication-form__group publication-form__group--col3">
        <div class="fg" (input)="cleanError('house')" [ngClass]="{'_error': getControlValidity('house', 'address')}">
          <label>Дом/строение</label>
          <input type="text"
                 [formControlName]="'house'"
                 (input)="cleanError('house')"
                 aria-label="House"
                 matInput
                 [matAutocomplete]="houseAuto"
                 (blur)="validateOrAutocompleteAddressItemSelection('address.house', houses)"
                 placeholder="Номер дома">
          <mat-autocomplete #houseAuto="matAutocomplete" [displayWith]="displayValue">
            <mat-option *ngFor="let option of house$ | async" [value]="option">
              {{ option.value }}
            </mat-option>
          </mat-autocomplete>
          <div class="fg__error-text">
            <div class="text12" *ngIf="getControlValidity('house', 'address')?.required">Обязательное поле</div>
            <div class="text12" *ngIf="getControlValidity('house', 'address')?.invalidChoice">Начните вводить и выберите город из списка</div>
            <div class="text12" *ngIf="errors && errors?.house">{{ errors.house![0] }}</div>
          </div>
        </div>
        <div class="fg" [ngClass]="{'_error': getControlValidity('floor', 'address')}">
          <label>Этаж</label>
          <input type="text" [formControlName]="'floor'" placeholder="этаж">
          <div class="fg__error-text">
            <div class="text12">Обязательное поле</div>
          </div>
        </div>
        <div class="fg" [ngClass]="{'_error': getControlValidity('office', 'address')}">
          <label>Кабинет</label>
          <input type="text" [formControlName]="'office'" placeholder="номер">
          <div class="fg__error-text">
            <div class="text12">Обязательное поле</div>
          </div>
        </div>
      </div>
    </ng-container>

    <div class="fg" [ngClass]="{'_error': getControlValidity('suit')}">
      <label>Подходит</label>
      <ng-select
        [items]="suit"
        bindLabel="title"
        bindValue="id"
        [clearable]="false"
        [searchable]="false"
        [formControlName]="'suit'"
        placeholder="Выберите тип">
      </ng-select>
      <div class="fg__error-text">
        <div class="text12">Обязательное поле</div>
      </div>
    </div>
    <div class="fg date-input2" [ngClass]="{'_error': getControlValidity('date')}">
      <label>Дата</label>
      <input type="text"
             (click)="picker.open()"
             [readOnly]="true"
             (keydown)="preventInput($event)"
             [formControlName]="'date'" placeholder="Дата"
             [matDatepicker]="picker">
      <div class="fg__error-text">
        <div class="text12">Обязательное поле</div>
      </div>
      <mat-datepicker #picker [dateClass]="highlightWeekend"></mat-datepicker>
    </div>
    <div class="publication-social _full">
      <div class="publication-social__title">
        <div class="text18 medium-text font2">
          Доступные мессенджеры
        </div>
      </div>
      <div class="publication-form__group publication-form__group--col2">
        <div class="fg" [ngClass]="{'_error': getControlValidity('whatsapp')}">
          <label>WhatsApp</label>
          <input type="tel"
                 mask="(000) 000-00-00"
                 [prefix]="'+7 '"
                 [instantPrefix]="true"
                 placeholder="+7 (___) ___-__-__"
                 (input)="cleanError('whatsapp')"
                 [formControlName]="'whatsapp'">
          <div class="fg__error-text">
            <div class="text12" *ngIf="getControlValidity('whatsapp')?.required">Обязательное поле</div>
            <div class="text12" *ngIf="getControlValidity('whatsapp')?.mask">
              Формат ввода: {{ getControlValidity('whatsapp')?.mask['requiredMask']}}
            </div>
            <div class="text12" *ngIf="errors && errors?.whatsapp">{{ errors.whatsapp![0] }}</div>
          </div>
        </div>
        <div class="fg" [ngClass]="{'_error': getControlValidity('telegram')}">
          <label>Telegram</label>
          <input type="text"
                 (input)="cleanError('telegram')"
                 [formControlName]="'telegram'" placeholder="Ваш TG аккаунт">
          <div class="fg__error-text">
            <div class="text12" *ngIf="getControlValidity('telegram')?.required">Обязательное поле</div>
            <div class="text12" *ngIf="getControlValidity('telegram')?.pattern">Введите корректную ссылку</div>
            <div class="text12" *ngIf="errors && errors?.telegram">{{ errors.telegram![0] }}</div>
          </div>
        </div>
      </div>
    </div>
    <div class="publication-form__text fg _full" [ngClass]="{'_error': getControlValidity('description')}">
      <label>Описание</label>
      <textarea [formControlName]="'description'"
                placeholder="Опишите ваше мероприятие"></textarea>
      <div class="fg__error-text">
        <div class="text12">Обязательное поле</div>
      </div>
    </div>
  </div>
  <div class="publication-category">
    <div class="publication-category__top">
      <div class="text16 font2 medium-text">
        Категории
      </div>
      <div class="publication-category__hint">
        <span>*</span> Не более {{ maxCatCount }}
      </div>
    </div>
    <div class="publication-category__items _flex">
      <div class="m-badge" *ngFor="let cat of publicationForm.get('categories').value">
        <img src="assets/img/marker.svg" alt="" *ngIf="!cat.image">
        <img src="{{ cat.image }}" alt="" *ngIf="cat.image">
        <span>{{ cat.title }}</span>
        <button class="m-badge__remove" (click)="removeCategory(cat.id)">
          <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.5 1L13.5 13" stroke="#1E1E1E" stroke-width="2" stroke-linecap="round"/>
            <path d="M13.5 1L1.5 13" stroke="#1E1E1E" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="publication-category__items2 _flex">
      <div class="publication-category__item"
           (click)="addCategory(category)"
           *ngFor="let category of categories">
        <img src="assets/img/plus2.svg" alt="">
        <span>{{ category.title }}</span>
      </div>
    </div>
    <div class="publication-category__bottom _flex-between">
      <div class="publication-category__text">
        <div class="text14">
          Если нет подходящей категории, вы можете оставить запрос на ее создание написав в поддержку на сайте или
          напрямую на почту для обратной связи
        </div>
      </div>
      <button class="publication-category__btn m-btn m-btn-black m-btn-bounce">
        <span>Оставить заявку на новую категорию</span>
      </button>
    </div>
  </div>
  <div class="publication-form__nav">
    <button [disabled]="!areFormsValid" (click)="proceed()" *ngIf="!edit"
            class="publication-form__btn m-btn m-btn-primary m-btn-bounce">
      <span>Разместить</span>
    </button>
    <button [disabled]="!areFormsValid" (click)="save()" *ngIf="edit"
            class="publication-form__btn m-btn m-btn-primary m-btn-bounce">
      <span>Сохранить</span>
    </button>
  </div>
</div>

